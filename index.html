<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Ministerio de Jóvenes | Conectando Generaciones</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
            width: 100%;
        }
        .lesson-card:hover {
            transform: translateY(-5px);
        }
        p, h1, h2, h3 {
            overflow-wrap: break-word;
            word-wrap: break-word;
        }
        #modal-overlay {
            transition: opacity 0.3s ease;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        @keyframes pulse-soft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        .animate-pulse-soft {
            animation: pulse-soft 2s infinite;
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        youthPrimary: '#6366f1',
                        youthSecondary: '#f43f5e',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 min-h-screen font-sans antialiased">

    <!-- Modal de Lecciones -->
    <div id="modal-overlay" class="hidden fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 w-full max-w-lg rounded-3xl p-8 shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <div id="modal-content">
                <!-- Contenido dinámico -->
            </div>
        </div>
    </div>

    <!-- Navegación -->
    <nav class="fixed w-full z-50 bg-white/90 dark:bg-gray-800/90 backdrop-blur-md border-b border-gray-200 dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-2">
                    <div class="bg-youthPrimary p-2 rounded-lg">
                        <i data-lucide="zap" class="text-white w-5 h-5 sm:w-6 sm:h-6"></i>
                    </div>
                    <span class="text-lg sm:text-xl font-bold tracking-tighter uppercase italic truncate">MJS | Jóvenes</span>
                </div>
                
                <div class="hidden md:flex space-x-6 lg:space-x-8 font-medium">
                    <a href="#inicio" class="hover:text-youthPrimary transition">Inicio</a>
                    <a href="#lecciones" class="hover:text-youthPrimary transition">Lecciones</a>
                    <a href="#eventos" class="hover:text-youthPrimary transition">Eventos</a>
                    <a href="#recursos" class="hover:text-youthPrimary transition">Recursos</a>
                </div>

                <div class="flex items-center gap-2 sm:gap-4">
                    <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition" aria-label="Cambiar tema">
                        <i id="theme-icon" data-lucide="moon" class="w-5 h-5"></i>
                    </button>
                    <button class="md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700" onclick="toggleMobileMenu()" aria-label="Abrir menú">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-4 space-y-2">
            <a href="#inicio" onclick="toggleMobileMenu()" class="block py-2 font-medium">Inicio</a>
            <a href="#lecciones" onclick="toggleMobileMenu()" class="block py-2 font-medium">Lecciones</a>
            <a href="#eventos" onclick="toggleMobileMenu()" class="block py-2 font-medium">Eventos</a>
            <a href="#recursos" onclick="toggleMobileMenu()" class="block py-2 font-medium">Recursos</a>
        </div>
    </nav>

    <!-- Hero Section -->
    <header id="inicio" class="pt-28 pb-12 px-4 sm:pt-36 sm:pb-20">
        <div class="max-w-5xl mx-auto text-center">
            <h1 class="text-4xl sm:text-5xl md:text-7xl font-black mb-6 uppercase leading-tight tracking-tighter">
                Más que una religión,<br><span class="text-youthPrimary">una relación.</span>
            </h1>
            <p class="text-base sm:text-lg md:text-xl text-gray-600 dark:text-gray-400 max-w-2xl mx-auto mb-10 px-2">
                Descubre tu propósito, encuentra comunidad y crece en tu fe de manera real.
            </p>
            
            <!-- Versículo del Día -->
            <div class="bg-white dark:bg-gray-800 p-6 sm:p-10 rounded-3xl shadow-xl border border-gray-100 dark:border-gray-700 max-w-3xl mx-auto mx-2">
                <div class="flex items-center justify-center gap-2 text-youthSecondary mb-4">
                    <i data-lucide="book-open" class="w-4 h-4 sm:w-5 h-5"></i>
                    <span class="font-bold uppercase tracking-widest text-xs sm:text-sm">Versículo del Día</span>
                </div>
                <div id="verse-container" class="min-h-[80px] flex flex-col justify-center">
                    <p id="verse-text" class="text-lg sm:text-2xl font-medium italic mb-4 leading-relaxed">"Cargando palabra de vida..."</p>
                    <p id="verse-ref" class="font-bold text-youthPrimary text-sm sm:text-base">--:--</p>
                </div>
                <button onclick="fetchVerse()" class="mt-4 text-xs font-bold text-gray-400 hover:text-youthPrimary flex items-center gap-1 mx-auto transition">
                    <i data-lucide="refresh-cw" class="w-3 h-3"></i> Actualizar
                </button>
            </div>
        </div>
    </header>

    <!-- Lecciones -->
    <section id="lecciones" class="py-16 bg-gray-100 dark:bg-gray-800/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6">
            <div class="flex flex-col lg:flex-row lg:items-end justify-between mb-10 gap-6">
                <div class="max-w-xl">
                    <h2 class="text-3xl sm:text-4xl font-bold mb-2">Enseñanzas</h2>
                    <p class="text-gray-500 text-sm sm:text-base">Explora mensajes recientes y profundiza en la Palabra.</p>
                </div>
                <div class="flex gap-2 overflow-x-auto pb-4 no-scrollbar">
                    <button onclick="filterLessons('Todas')" class="filter-btn active whitespace-nowrap bg-youthPrimary text-white px-5 py-2 rounded-full text-xs sm:text-sm font-bold shadow-lg shadow-youthPrimary/20">Todas</button>
                    <button onclick="filterLessons('Fe')" class="filter-btn whitespace-nowrap bg-white dark:bg-gray-700 px-5 py-2 rounded-full text-xs sm:text-sm font-bold">Fe</button>
                    <button onclick="filterLessons('Vida')" class="filter-btn whitespace-nowrap bg-white dark:bg-gray-700 px-5 py-2 rounded-full text-xs sm:text-sm font-bold">Vida</button>
                    <button onclick="filterLessons('Relaciones')" class="filter-btn whitespace-nowrap bg-white dark:bg-gray-700 px-5 py-2 rounded-full text-xs sm:text-sm font-bold">Relaciones</button>
                </div>
            </div>
            <div id="lessons-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8"></div>
        </div>
    </section>

    <!-- Eventos -->
    <section id="eventos" class="py-16">
        <div class="max-w-4xl mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-3xl sm:text-4xl font-bold mb-3">Nuestra Reunión</h2>
                <p class="text-gray-500 italic text-sm">El momento más importante de la semana para crecer juntos.</p>
            </div>
            
            <div class="space-y-4">
                <!-- Evento de Jueves -->
                <div id="event-jueves" class="flex flex-col sm:flex-row items-center gap-4 sm:gap-6 p-6 sm:p-8 bg-white dark:bg-gray-800 rounded-3xl border-l-8 border-youthPrimary shadow-lg hover:shadow-xl transition-shadow">
                    <div class="text-center bg-youthPrimary/10 p-4 rounded-2xl min-w-[100px]">
                        <span class="block text-sm font-black text-youthPrimary uppercase tracking-tighter leading-none">Todos los</span>
                        <span class="block text-3xl font-black text-youthPrimary uppercase tracking-tighter">Jueves</span>
                    </div>
                    <div class="flex-grow text-center sm:text-left">
                        <h3 class="text-xl sm:text-2xl font-black leading-tight uppercase italic">Reunión de Juveniles</h3>
                        <div class="flex flex-wrap justify-center sm:justify-start gap-4 mt-2">
                            <span class="flex items-center gap-1 text-sm font-bold text-gray-500 dark:text-gray-400">
                                <i data-lucide="video" class="w-4 h-4 text-youthPrimary"></i> Online
                            </span>
                            <span class="flex items-center gap-1 text-sm font-bold text-gray-500 dark:text-gray-400">
                                <i data-lucide="clock" class="w-4 h-4"></i> 9:00 PM
                            </span>
                        </div>
                    </div>
                    <div class="flex flex-col gap-2 w-full sm:w-auto">
                        <button id="reminder-btn-jueves" onclick="scheduleNotifications('jueves')" class="w-full sm:w-auto bg-youthPrimary text-white px-6 py-3 rounded-2xl font-black uppercase text-xs tracking-widest hover:scale-105 transition flex items-center justify-center gap-2">
                            <i data-lucide="bell" class="w-4 h-4"></i> Recuérdame
                        </button>
                        <button id="cancel-reminder-btn-jueves" onclick="cancelNotifications('jueves')" class="hidden w-full sm:w-auto bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-6 py-2 rounded-xl font-bold uppercase text-[10px] tracking-wider hover:bg-red-100 hover:text-red-500 dark:hover:bg-red-900/30 transition flex items-center justify-center gap-2">
                            <i data-lucide="bell-off" class="w-3 h-3"></i> Desactivar Aviso
                        </button>
                    </div>
                </div>
            </div>

            <!-- Botón de Prueba Actualizado -->
            <div class="mt-12 text-center">
                <button id="test-notif-btn" onclick="triggerDelayedNotification()" class="group relative inline-flex items-center gap-2 text-gray-400 dark:text-gray-500 hover:text-youthPrimary dark:hover:text-youthPrimary transition text-xs font-bold uppercase tracking-widest border border-dashed border-gray-300 dark:border-gray-700 px-6 py-3 rounded-full overflow-hidden">
                    <span id="test-btn-content" class="flex items-center gap-2 transition-all">
                        <i data-lucide="terminal" class="w-3 h-3"></i> Notificación de Prueba
                    </span>
                    <!-- Barra de progreso invisible por defecto -->
                    <div id="test-progress-bar" class="absolute bottom-0 left-0 h-1 bg-youthPrimary w-0 transition-all duration-[30000ms] ease-linear"></div>
                </button>
            </div>
        </div>
    </section>

    <!-- Recursos -->
    <section id="recursos" class="py-16 bg-youthPrimary text-white">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <h2 class="text-3xl font-bold mb-10">Recursos Gratuitos</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="p-6 sm:p-8 bg-white/10 backdrop-blur-md rounded-3xl border border-white/20">
                    <i data-lucide="music" class="w-10 h-10 mx-auto mb-4"></i>
                    <h3 class="text-lg font-bold mb-2 uppercase tracking-tight">Worship Playlist</h3>
                    <p class="text-sm text-white/80 mb-6">Música para tus tiempos a solas con Dios.</p>
                    <button onclick="handleExternalLink('Spotify')" class="inline-block bg-white text-youthPrimary px-6 py-2 rounded-full font-bold text-sm hover:scale-105 transition">Escuchar Ahora</button>
                </div>
                <div class="p-6 sm:p-8 bg-white/10 backdrop-blur-md rounded-3xl border border-white/20">
                    <i data-lucide="file-text" class="w-10 h-10 mx-auto mb-4"></i>
                    <h3 class="text-lg font-bold mb-2 uppercase tracking-tight">Guías de Estudio</h3>
                    <p class="text-sm text-white/80 mb-6">PDFs para profundizar en grupos pequeños.</p>
                    <button onclick="handleExternalLink('Descarga')" class="inline-block bg-white text-youthPrimary px-6 py-2 rounded-full font-bold text-sm hover:scale-105 transition">Ver Guías</button>
                </div>
                <div class="p-6 sm:p-8 bg-white/10 backdrop-blur-md rounded-3xl border border-white/20">
                    <i data-lucide="message-circle" class="w-10 h-10 mx-auto mb-4"></i>
                    <h3 class="text-lg font-bold mb-2 uppercase tracking-tight">Peticiones</h3>
                    <p class="text-sm text-white/80 mb-6">Estamos aquí para orar por ti.</p>
                    <button onclick="handleExternalLink('Oración')" class="inline-block bg-white text-youthPrimary px-6 py-2 rounded-full font-bold text-sm hover:scale-105 transition">Enviar Oración</button>
                </div>
            </div>
        </div>
    </section>

    <footer class="py-10 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 px-4">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="text-center md:text-left">
                <span class="text-xl font-black italic uppercase">MJS | Jóvenes</span>
                <p class="text-gray-400 text-[10px] mt-1 uppercase tracking-widest font-bold">Hecho para Su gloria.</p>
            </div>
            <div class="flex gap-4">
                <button onclick="handleExternalLink('Instagram')" class="p-2 bg-gray-50 dark:bg-gray-800 rounded-full hover:text-youthPrimary transition"><i data-lucide="instagram" class="w-5 h-5"></i></button>
                <button onclick="handleExternalLink('YouTube')" class="p-2 bg-gray-50 dark:bg-gray-800 rounded-full hover:text-youthPrimary transition"><i data-lucide="youtube" class="w-5 h-5"></i></button>
                <button onclick="handleExternalLink('Mensaje')" class="p-2 bg-gray-50 dark:bg-gray-800 rounded-full hover:text-youthPrimary transition"><i data-lucide="message-square" class="w-5 h-5"></i></button>
            </div>
        </div>
    </footer>

    <script>
        const lessonsData = [
            { id: 1, title: "Identidad Digital", date: "15 Feb, 2024", category: "Vida", content: "¿Quién eres cuando nadie te está dando 'like'? Descubre tu valor real en Cristo. En este mundo de filtros, Dios te ama al natural." },
            { id: 2, title: "Dudas y Fe", date: "08 Feb, 2024", category: "Fe", content: "Está bien tener preguntas. Veamos cómo Jesús respondió a Tomás con amor. Las dudas no matan la fe, la hacen buscar respuestas más profundas." },
            { id: 3, title: "Amor y Respeto", date: "01 Feb, 2024", category: "Relaciones", content: "Cómo amar de verdad protegiendo tu corazón y el de la otra persona en el noviazgo. El amor real sabe esperar y sabe cuidar." },
            { id: 4, title: "Libertad Real", date: "25 Ene, 2024", category: "Vida", content: "Soltar la carga del rencor para vivir en libertad absoluta mediante el perdón. Perdonar no es olvidar, es decidir que el pasado no controle tu presente." },
            { id: 5, title: "Biblia 101", date: "18 Ene, 2024", category: "Fe", content: "Herramientas prácticas para que tu tiempo con Dios sea dinámico y profundo. No es solo leer, es conectar con el autor de la vida." }
        ];

        let activeTimeouts = { jueves: [] };
        let isTesting = false;

        lucide.createIcons();

        function checkNotificationStatus() {
            if (!("Notification" in window)) return;
            if (Notification.permission === "granted") {
                setUIAsProgrammed('jueves');
            } else {
                resetReminderButton('jueves');
            }
        }

        function setUIAsProgrammed(eventId) {
            const btn = document.getElementById(`reminder-btn-${eventId}`);
            const cancelBtn = document.getElementById(`cancel-reminder-btn-${eventId}`);
            if (btn && cancelBtn) {
                btn.innerHTML = `<i data-lucide="check" class="w-4 h-4"></i> Programado`;
                btn.classList.remove('bg-youthPrimary');
                btn.classList.add('bg-green-500', 'pointer-events-none');
                cancelBtn.classList.remove('hidden');
                lucide.createIcons();
            }
        }

        async function scheduleNotifications(eventId) {
            if (!("Notification" in window)) {
                alert("Este navegador no soporta notificaciones.");
                return;
            }
            if (Notification.permission === "denied") {
                alert("Has bloqueado las notificaciones. Cámbialo en la configuración del navegador.");
                return;
            }
            const permission = await Notification.requestPermission();
            if (permission === "granted") {
                setUIAsProgrammed(eventId);
                activeTimeouts[eventId].forEach(id => clearTimeout(id));
                activeTimeouts[eventId] = [];
                const now = new Date();
                let eventTime = new Date();
                if (eventId === 'jueves') {
                    eventTime.setDate(now.getDate() + (4 + 7 - now.getDay()) % 7);
                    eventTime.setHours(21, 0, 0, 0);
                    if (eventTime <= now) eventTime.setDate(eventTime.getDate() + 7);
                }
                const timesToNotify = [
                    { time: 30, msg: "¡Faltan 30 minutos! Te esperamos en la Reunión Online de Juveniles." },
                    { time: 15, msg: "¡Solo 15 minutos! Prepara tu conexión." },
                    { time: 0, msg: "¡ESTAMOS EN VIVO! Entra ahora mismo." }
                ];
                timesToNotify.forEach(notif => {
                    const scheduledDate = new Date(eventTime.getTime() - notif.time * 60000);
                    const delay = scheduledDate.getTime() - now.getTime();
                    if (delay > 0) {
                        const timeoutId = setTimeout(() => {
                            new Notification("MJS | Recordatorio", {
                                body: notif.msg,
                                icon: "https://cdn-icons-png.flaticon.com/512/3652/3652191.png"
                            });
                        }, delay);
                        activeTimeouts[eventId].push(timeoutId);
                    }
                });
            } else {
                resetReminderButton(eventId);
            }
        }

        // --- LÓGICA DE NOTIFICACIÓN DE PRUEBA CREATIVA ---
        async function triggerDelayedNotification() {
            if (isTesting) return;

            if (!("Notification" in window)) {
                alert("Navegador no compatible.");
                return;
            }

            if (Notification.permission === "denied") {
                alert("Habilita los permisos en la configuración de tu navegador.");
                return;
            }

            const permission = await Notification.requestPermission();
            if (permission !== "granted") return;

            isTesting = true;
            const btn = document.getElementById('test-notif-btn');
            const content = document.getElementById('test-btn-content');
            const progress = document.getElementById('test-progress-bar');
            
            btn.classList.add('pointer-events-none', 'border-youthPrimary', 'text-youthPrimary');
            progress.style.width = '100%';

            const waitingMessages = [
                "Afinando las guitarras...",
                "Preparando el café virtual...",
                "Buscando el versículo clave...",
                "Conectando con el servidor...",
                "Casi listos para el aviso...",
                "Acomodando las sillas...",
                "Ultimando detalles..."
            ];

            let timeLeft = 30;
            const interval = setInterval(() => {
                timeLeft--;
                const randomMsg = waitingMessages[Math.floor(Math.random() * waitingMessages.length)];
                content.innerHTML = `<span class="animate-pulse-soft flex items-center gap-2 italic"><i data-lucide="loader-2" class="w-3 h-3 animate-spin"></i> ${randomMsg} (${timeLeft}s)</span>`;
                lucide.createIcons();

                if (timeLeft <= 0) {
                    clearInterval(interval);
                    sendTestNotification();
                    resetTestButton();
                }
            }, 1000);

            // Primer mensaje inmediato
            content.innerHTML = `<span class="animate-pulse-soft flex items-center gap-2 italic"><i data-lucide="loader-2" class="w-3 h-3 animate-spin"></i> ${waitingMessages[0]} (${timeLeft}s)</span>`;
            lucide.createIcons();
        }

        function resetTestButton() {
            isTesting = false;
            const btn = document.getElementById('test-notif-btn');
            const content = document.getElementById('test-btn-content');
            const progress = document.getElementById('test-progress-bar');
            
            btn.classList.remove('pointer-events-none', 'border-youthPrimary', 'text-youthPrimary');
            progress.style.transition = 'none';
            progress.style.width = '0';
            setTimeout(() => progress.style.transition = 'all duration-[30000ms] ease-linear', 50);

            content.innerHTML = `<i data-lucide="terminal" class="w-3 h-3"></i> Notificación de Prueba`;
            lucide.createIcons();
        }

        function sendTestNotification() {
            new Notification("Prueba de MJS", {
                body: "¡Funciona! Así recibirás los avisos de nuestras reuniones.",
                icon: "https://cdn-icons-png.flaticon.com/512/3652/3652191.png"
            });
        }

        function cancelNotifications(eventId) {
            if (activeTimeouts[eventId]) {
                activeTimeouts[eventId].forEach(id => clearTimeout(id));
                activeTimeouts[eventId] = [];
            }
            resetReminderButton(eventId);
        }

        function resetReminderButton(eventId) {
            const btn = document.getElementById(`reminder-btn-${eventId}`);
            const cancelBtn = document.getElementById(`cancel-reminder-btn-${eventId}`);
            if (btn && cancelBtn) {
                btn.innerHTML = `<i data-lucide="bell" class="w-4 h-4"></i> Recuérdame`;
                btn.classList.add('bg-youthPrimary');
                btn.classList.remove('bg-green-500', 'pointer-events-none');
                cancelBtn.classList.add('hidden');
                lucide.createIcons();
            }
        }

        // --- Funciones del sitio ---
        const modalOverlay = document.getElementById('modal-overlay');
        const modalContent = document.getElementById('modal-content');

        function showLessonModal(id) {
            const lesson = lessonsData.find(l => l.id === id);
            if (!lesson) return;
            modalContent.innerHTML = `
                <span class="bg-youthPrimary/10 text-youthPrimary px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-wider mb-4 inline-block">${lesson.category}</span>
                <h2 class="text-3xl font-black mb-4 leading-tight">${lesson.title}</h2>
                <p class="text-gray-500 dark:text-gray-400 mb-6 leading-relaxed">${lesson.content}</p>
                <div class="text-xs text-gray-400 font-bold">Publicado el ${lesson.date}</div>
            `;
            modalOverlay.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; 
        }

        function closeModal() {
            modalOverlay.classList.add('hidden');
            document.body.style.overflow = ''; 
        }

        function handleExternalLink(type) {
            alert(`Pronto te redirigiremos a nuestro espacio de ${type}. ¡Mantente conectado!`);
        }

        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const html = document.documentElement;

        themeToggle.addEventListener('click', () => {
            const isDark = html.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            themeIcon.setAttribute('data-lucide', isDark ? 'sun' : 'moon');
            lucide.createIcons();
        });

        async function fetchVerse() {
            const vText = document.getElementById('verse-text');
            const vRef = document.getElementById('verse-ref');
            try {
                const res = await fetch('https://bible-api.com/john+3:16?translation=rva');
                const data = await res.json();
                vText.innerText = `"${data.text.trim()}"`;
                vRef.innerText = data.reference;
            } catch (e) {
                vText.innerText = '"Porque yo sé los pensamientos que tengo acerca de vosotros, dice Jehová, pensamientos de paz, y no de mal."';
                vRef.innerText = "Jeremías 29:11";
            }
        }

        function renderLessons(filter = 'Todas') {
            const grid = document.getElementById('lessons-grid');
            grid.innerHTML = '';
            const filtered = filter === 'Todas' ? lessonsData : lessonsData.filter(l => l.category === filter);
            filtered.forEach(lesson => {
                const card = document.createElement('div');
                card.className = "lesson-card bg-white dark:bg-gray-800 p-6 rounded-3xl shadow-lg border border-gray-100 dark:border-gray-700 transition duration-300 flex flex-col";
                card.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <span class="bg-youthPrimary/10 text-youthPrimary px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-wider">${lesson.category}</span>
                        <span class="text-[10px] text-gray-400 font-bold uppercase">${lesson.date}</span>
                    </div>
                    <h3 class="text-lg font-bold mb-3 leading-tight">${lesson.title}</h3>
                    <p class="text-gray-500 dark:text-gray-400 text-sm mb-6 flex-grow line-clamp-3">${lesson.content}</p>
                    <button onclick="showLessonModal(${lesson.id})" class="flex items-center gap-2 text-youthPrimary font-black text-xs uppercase hover:tracking-widest transition-all">
                        Ver más <i data-lucide="arrow-right" class="w-4 h-4"></i>
                    </button>
                `;
                grid.appendChild(card);
            });
            lucide.createIcons();
        }

        function filterLessons(cat) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-youthPrimary', 'text-white', 'shadow-lg', 'shadow-youthPrimary/20');
                btn.classList.add('bg-white', 'dark:bg-gray-700');
                if(btn.innerText === cat) btn.classList.add('bg-youthPrimary', 'text-white', 'shadow-lg', 'shadow-youthPrimary/20');
            });
            renderLessons(cat);
        }

        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }

        window.onload = () => {
            fetchVerse();
            renderLessons();
            checkNotificationStatus();
        };

        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) closeModal();
        });
    </script>
</body>
</html>
